<style>
    body {
        margin: 0;
    }

    .accordion {
        background-color: white;
        cursor: pointer;
        border: none;
        text-align: left;
        color: gray;
        outline: none;
        padding: 10px 0px;
        font-size: 14px;
        transition: 0.4s;
    }

    .accordion:after {
        content: '\25BC';
        color: #777;
        font-weight: bold;
        float: right;
        margin-left: 5px;
    }

    .active:after {
        content: "\25B2";
    }

    .hidden {
        display: none;
    }

    .modal {
        display: none; 
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 20% auto 0% auto;
        padding: 20px 20px 20px 40px;
        width: 40%;
        border-radius: 6px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    }

    .modal-content p {
        font-family: Helvetica, Arial, sans-serif;
    }

    .modal-content #modal-title {
        font-size: 16px;
        font-weight: bold;
    }

    .modal-content input {
        border: none;
        font-size: 16px;
        vertical-align: middle;
    }

    .modal-content .modal-icon {
        vertical-align: middle;
    }

    .modal-content #modal-results .modal-img {
        display: block;
        margin: auto;
        margin-top: 30px;
    }

    .modal-content #modal-results p {
        text-align: center;
    }

    .modal-content #modal-results #modal-search {
        font-size: 16px;
        color: lightgrey;
    }

    .modal-content hr {
        margin: 5px 25px;
    }

    .modal-content button {
        background-color: #4F2683;
        color: white;
        padding: 7px 14px;
        border: none;
        border-radius: 3px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    } 
    
    #nav {
        list-style-type: none;
        margin: 0;
        padding: 0 25%;
        overflow: hidden;
        background-color: #4F2683;
        display: flex;
        align-items: center;
    }
    
    #nav li {
        float: left;
    }
    
    #nav img {
        padding: 5px;
    }
    
    #nav #options {
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        margin-left: auto;
    }

    #nav #options img {
        padding: 10px;
    }

    #nav .dropdown button {
        background-color: #4F2683;
        border: none;
        color: white;
        padding: 0;
        cursor: pointer;
    }

    #nav > button {
        background: #69409D;
        border: none;
        border-radius: 0px 3px 3px 0px;
        padding: 0px;
        margin-right: 5px;
        cursor: pointer;
    }

    #nav .dropdown {
        float: left;
        overflow: hidden;
    }

    #nav .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
    }

    #nav .dropdown-content a {
        float: none;
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        text-align: left;
    }

    #nav .show {
        display: block;
    }

    #nav input {
        height: 30px;
        padding: 6px;
        margin-left: 13.5%;
        border-radius: 3px 0px 0px 3px;
        border: none;
        flex: 1;
        color: #f9f9f9;
        background-color: #69409D;
    }

    .ui-autocomplete div {
        font-family: Helvetica, Arial, sans-serif;
        font-size: 14px;
    }

    .ui-autocomplete .ui-state-active {
        background: #4F2683 !important;
        border: 1px solid #69409D !important;
    }

    #wrapper {
        display: flex;
        min-height: 95vh;
        height: auto;
    }

    #wrapper > div {
        flex-basis: 0;
    }

    #wrapper > div:first-of-type { 
        background-color: #F9F9F9;
        flex-grow: 9;
    }

    #wrapper > div:nth-of-type(2) { 
        flex-grow: 12;
        background-color: white;
        border: solid #EFF0F1;
        border-width: 0 1px;
    }
    
    #wrapper > div:nth-of-type(3) { 
        flex-grow: 7;
        background-color: #F9F9F9;
    }

    #course-registration {
        padding: 20px 30px;
    }

    #course-registration .title {
        font-family: Helvetica, Arial, sans-serif;
        font-size: 20px;
        margin: 10px 0px;
    }

    #course-registration .panel {
        background-color: white;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.2s ease-out;
    }
    
    #course-registration span {
        font-family: Helvetica, Arial, sans-serif;
        font-size: 14px;
        margin: 10px 0px;
        vertical-align: middle;
    }

    #course-registration .courses {
        margin-left: 15px;
    }

    #course-registration .courses span {
        margin: 10px 5px;
    }

    #course-registration .add-course {
        cursor: pointer;
    }

    #course-registration .add-course span {
        color: #4F2683;
    }

    #course-registration .semester {
        font-family: Helvetica, Arial, sans-serif;
        font-size: 18px;
    }

    #course-registration img {
        vertical-align: middle;
    }

    #course-registration .remove-course {
        display: none;
    }

    #course-registration .panel:first-of-type .remove-course {
        display: block;
        margin: 4px;
        cursor: pointer;
        float: right;
    }

    #course-registration hr {
        border-top: 1px solid white;
    }

    #progress {
        width: 200px;
        float: right;
    }

    #progress > div {
        margin: 10px;
        padding: 6px 10px;
        background: grey;
        border-radius: 6px;
    }

    #progress span, 
    #progress p {
        font-family: Helvetica, Arial, sans-serif;
        font-size: 13px;
        font-weight: bold;
        color: white;
        vertical-align: middle;
    }

    #progress p {
        text-align: center;
        margin: 10px 0px;
    }

    #progress #major-progress-text {
        font-size: 11px;
    }

    #progress #minor-progress-text {
        font-size: 10px;
    }

    #progress .progress-icon {
        vertical-align: middle;
    }

    #progress .progress-img {
        display: block;
        margin: auto;
        margin-top: 5px;
    }

    #progress-major .progress-img {
        margin-top: 10px;
        width: 120px;
    }

    #progress-major #progressbar {
        height: 8px;
        border-radius: 5px;
        margin: 0px 19px;
    }

    #progress-minor #progressbar {
        height: 5px;
        border-radius: 4px;
        margin: 0px 35px;
    }

    #progress .ui-progressbar-value {
        border-radius: 10px;
    }

    #progress-home span {
        margin-left: 5px;
    }
}
</style>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="style/jquery-ui.min.css">
    <script src="scripts/jquery-3.3.1.min.js"></script>
    <script src="scripts/jquery-ui.min.js"></script>
    <script src="scripts/handlebars-v4.0.11.js"></script>
</head>

<body>
    <!-- NAVIGATION -->
    <div id="nav">
        <li>
            <a href="http://studentservices.uwo.ca/secure/timetables/mastertt/ttindex.cfm" target="_blank">
                <img src="images/icon-western.png">
            </a>
        </li>
        <input type="text" id="search-nav" placeholder="Search my courses">
        <button type="submit"><img src="images/icon-search-white-20.png"></button>  
        <ul id="options">
            <li class="dropdown">
                <button class="add-course">
                    <img src="images/icon-plus-20.png">
                    <div class="dropdown-content">
                        <a href="#">Link 1</a>
                        <a href="#">Link 2</a>
                        <a href="#">Link 3</a>
                    </div>
                </button>
            </li>
            <li class="dropdown">
                <button class="dropbtn">
                    <img src="images/icon-notification-20.png">
                    <div class="dropdown-content">
                        <a href="#">Link 1</a>
                        <a href="#">Link 2</a>
                        <a href="#">Link 3</a>
                    </div>
                </button>
            </li>
            <li class="dropdown">
                <button class="dropbtn">
                    <img src="images/icon-user-20.png">
                    <div class="dropdown-content">
                        <a href="#">Link 1</a>
                        <a href="#">Link 2</a>
                        <a href="#">Link 3</a>
                    </div>
                </button>
            </li>
        </ul>
    </div>
    <!-- MAIN CONTENT -->
    <div id="wrapper">
        <!-- PROGRESS -->
        <div id="c1">
            <div id="progress">
                <div id="progress-home">
                    <img class="progress-icon" src="images/icon-home-20.png">
                    <span>Courses</span>
                </div>
                <div id="progress-major">
                    <img class="progress-img" src="images/img-diploma.png">
                    <p style="margin-top: 0px;">Specialization in Computer Science</p>
                    <div id="progressbar"></div>
                    <p id="major-progress-text"></p>
                </div>
                <div id="progress-minor">
                    <img class="progress-img" src="images/icon-diploma-40.png">
                    <p>Minor in Software Engineering</p>
                    <div id="progressbar"></div>
                    <p id="minor-progress-text"></p>
                </div>
            </div>
        </div>
        <!-- COURSE REGISTRATION -->
        <div id="c2">
            <div id="course-registration">
                <p class="title">Course Registration</p>
                <!-- COURSE TEMPLATE -->
            </div>
            <!-- MODAL -->
            <div id="course-modal" class="modal">
              <!-- Modal content -->
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <p id="modal-title">Add Course</p>
                    <img class="modal-icon" src="images/icon-search-20.png">
                    <input type="text" placeholder="Search courses">
                    <hr>
                    <div id="modal-results">
                        <img class="modal-img" src="images/icon-search-20.png">
                        <p id="modal-search">Nothing has been searched yet!</p>
                    </div>
                    <button id="modal-button">Add course</button>
                </div>
            </div>
        </div>
        <div id="c3">
        </div>
    </div>
</body>
</html>

<!-- TEMPLATE -->
<script id="course-year" type="text/x-handlebars-template">
    {{#each semesters}}
        <button class="accordion">Year {{programYear}} - {{year}}</button>
        <div class="panel">
            <!-- FALL -->
            <img class="semester-icon" src="images/icon-fall-30.png">
            <span class="semester">Fall Semester</span>
            <hr>
            <div class="courses" id="fall-courses">
                {{#each semester.fall}}
                    {{> course}}
                {{/each}}
                {{#if @first}}
                    <div class="add-course{{#checklength semester.fall 4}} hidden{{/checklength}}">
                        <img class="semester-icon" src="images/icon-purple-plus-20.png">
                        <span>Add course</span>
                    </div>
                {{/if}}
            </div>
            <br>
            <!-- WINTER -->
            <img class="semester-icon" src="images/icon-winter-30.png">
            <span class="semester">Winter Semester</span>
            <hr>
            <div class="courses" id="winter-courses">
                {{#each semester.winter}}
                    {{> course}}
                {{/each}}
                {{#if @first}}
                    <div class="add-course{{#checklength semester.winter 4}} hidden{{/checklength}}">
                        <img class="semester-icon" src="images/icon-purple-plus-20.png">
                        <span>Add course</span>
                    </div>
                {{/if}}
            </div>
        </div>
    {{/each}}
</script>

<!-- TEMPLATE -->
<script id="course-partial" type="text/x-handlebars-template">
    <div class="course">
        <img class="semester-icon" src="{{courseImage}}">
        <span>{{course}}</span>
        <img class="remove-course" src="images/icon-delete-15.png">
        <hr>
    </div>
</script>

<script>

    // Stop mime errors for getting local JSON file
    $.ajaxSetup({beforeSend: function(xhr) {
        if (xhr.overrideMimeType) {
          xhr.overrideMimeType("application/json");
        }
      }
    });

    // Progress bar for major
    function majorProgress() {
        major = $(".course").length;
        $("#major-progress-text").text(major/2 + " / 20");
        $("#progress-major #progressbar").progressbar({
            value: Math.floor(major * 2.5)
        });
    }

    // Progress bar for minor
    function minorProgress() {
        minor = $(".panel").first().find(".course").length;
        $("#minor-progress-text").text(minor/2 + " / 5");
        $("#progress-minor #progressbar").progressbar({
            value: minor * 10
        });
    }

    $(document).ready(function() {
        var userData, addLocation, self, major, minor;

        $.getJSON("data/user.json", userCallback);

        Handlebars.registerHelper('checklength', function (v1, v2, options) {
            'use strict';
            if (v1.length>v2) {
                return options.fn(this);
            }
            return options.inverse(this);
        });

        // Modal
        var modal = document.getElementById('course-modal');

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Toggle between hiding and showing the dropdown content
        $(".dropbtn").click(function(e) {
            e.stopPropagation();
            $(this).parent().siblings().find(".dropdown-content").removeClass("show"); // hide other menus
            $(this).find(".dropdown-content").toggleClass("show");
        });

        // Close the dropdown if the user clicks outside of it
        $("body").click(function() {
            $(".dropdown-content").removeClass("show");
        });

        // Things to do after getting user data
        function userCallback(data) {
            userData = data;

            // Compile template
            var template = Handlebars.compile($('#course-year').html());
            Handlebars.registerPartial("course", $('#course-partial').html());

            // Render template
            var courseHTML = template(userData);
            $("#course-registration").append(courseHTML);

            Handlebars.unregisterPartial("course");

            // Accordion
            var acc = document.getElementsByClassName("accordion");
            var i;

            for (i = 0; i < acc.length; i++) {
              acc[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var panel = this.nextElementSibling;
                if (panel.style.maxHeight){
                  panel.style.maxHeight = null;
                } else {
                  panel.style.maxHeight = "515px";
                } 
              });
            }

            majorProgress();
            minorProgress();

            // Click first course accordion to open for user
            $(".accordion").first().click();

            $(function() {
                var availableTags = [];
                $('.course').find("span").each(function(){
                    availableTags.push($(this).text());
                });
                $( "#search-nav" ).autocomplete({
                    source: availableTags.sort()
                });
            });

            // Displays Modal on add course click
            $(".add-course").click(function() {
                $("#course-modal").css("display", "block");
                addLocation = $(this);
            });

            // Removes course when pressed
            $(".remove-course").click(function() {
                $(this).closest(".courses").find(".add-course").removeClass("hidden");
                $(this).parent().remove();
                minorProgress();
                majorProgress();
            });

            // Hides model on (x) click
            $(".close").click(function() {
                $("#course-modal").css("display", "none");
            });

            // Add course button
            $("#modal-button").click(function(){
                var courseTemplate = Handlebars.compile($('#course-partial').html());
                var addCourse = courseTemplate(userData.semesters[0].semester.fall[0]);
                $(addLocation).before(addCourse);
                self = $(addLocation).prev();
                self.find(".remove-course").click(function() {
                    $(this).closest(".courses").find(".add-course").removeClass("hidden")
                    $(this).parent().remove();
                    minorProgress();
                    majorProgress();
                });
                if($(addLocation).closest(".courses").find(".course").length >= 5) {
                    $(self).closest(".courses").find(".add-course").addClass("hidden");
                }
                minorProgress();
                majorProgress();
                $("#course-modal").css("display", "none");
            });
        }
    });
</script>
